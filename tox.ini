[tox]
envlist = py{35,36,37}{,-pyramid},pypy{3}{,-pyramid},coverage,lint,mypy

[testenv]
commands = py.test
deps =
  pytest
  pytest-randomly
  -cconstraints.txt
extras =
  pyramid: pyramid

[testenv:coverage]
basepython = python3.7
commands =
  coverage run -m py.test
  coverage report --show-missing --fail-under=100
deps =
  pytest
  coverage
  -cconstraints.txt
extras =
  pyramid

[testenv:lint]
skip_install = true
basepython = python3.7
commands =
  python setup.py -q sdist bdist_wheel
  black --check --diff .
  check-manifest
  flake8
  twine check dist/*
deps =
  black
  check-manifest
  flake8
  readme_renderer[md]
  twine
  -cconstraints.txt

[testenv:mypy]
skip_install = true
basepython = python3.7
commands = mypy --ignore-missing-imports .
deps =
  mypy
  mypy-zope
  -cconstraints.txt
